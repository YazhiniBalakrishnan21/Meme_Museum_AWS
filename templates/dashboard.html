{% extends "base.html" %}

{% block content %}
<h2>Dashboard</h2>

<div style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
  <a href="{{ url_for('upload') }}"><button style="max-width:200px;">Upload Meme</button></a>
  <a href="{{ url_for('saved') }}"><button style="max-width:200px;">Saved</button></a>
</div>

{% for meme in memes %}

<div class="meme">
  <h3>{{ meme.title }}</h3>
  <a href="{{ url_for('view_meme', meme_id=meme.meme_id) }}">
    <img src="{{ meme.url }}" alt="meme">
  </a>

  <div class="actions">
    <a href="{{ url_for('like_meme', meme_id=meme.meme_id) }}">üëç Like ({{ meme.likes }})</a>
    <a href="#" onclick="shareMeme('{{ meme.url }}'); return false;">Share</a>
    <a href="{{ url_for('download_meme', meme_id=meme.meme_id) }}">Download</a>
  </div>

  <form method="POST" action="{{ url_for('delete_meme', meme_id=meme.meme_id) }}" style="margin-top:12px;">
    <button type="submit">üóë Delete Meme</button>
  </form>

  <hr style="border:1px solid #d9c2ab; margin:15px 0;">

  {% if meme.comments and meme.comments|length > 0 %}
    <div style="text-align:left; margin-top:15px;">
      <h4 style="margin-bottom:8px;">Comments</h4>
      {% for c in meme.comments %}
        <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; margin:6px 0;">
          <div><b>{{ c.user }}:</b> {{ c.text }}</div>
        </div>
      {% endfor %}
    </div>
  {% endif %}
</div>

{% endfor %}

<script>
function shareMeme(link) {
  navigator.clipboard.writeText(link);
  alert("Meme link copied!");
}

function toggleEmojiBox(index) {
  const box = document.getElementById("emoji-box-" + index);
  box.style.display = (box.style.display === "none" || box.style.display === "") ? "block" : "none";
}

function addEmoji(index, emoji) {
  const input = document.getElementById("comment-" + index);
  input.value += emoji;
  input.focus();
}
</script>

{% endblock %}
